<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
    />
    <meta name="generator" content="WASM-4 1.0.10" />
    <title>WASM-4 Game</title>
    <style type="text/css" id="wasm4-css">*{box-sizing:border-box}body,html{height:100%;margin:0}body{background:#202020;font-family:system-ui;touch-action:none}.container{align-items:center;display:flex;height:100%;justify-content:center;width:100%}#content{height:100vmin;overflow:hidden;width:100vmin}#content canvas,#screenshot img{height:100%;image-rendering:pixelated;image-rendering:crisp-edges;width:100%}@media (pointer:fine){.gamepad{display:none}}body.focus #screenshot,body.focus .infobox,body:not(.focus) .gamepad{display:none}.gamepad{pointer-events:none}#gamepad-dpad{background:#444;border-radius:9px;bottom:30px;height:120px;left:69px;position:absolute;width:39px}#gamepad-dpad:before{background:#444;border-radius:9px;left:-39px;width:120px}#gamepad-dpad:after,#gamepad-dpad:before{content:"";height:39px;position:absolute;top:39px}#gamepad-dpad:after{background:#333;border-radius:100%;width:39px}#gamepad-dpad.pressed-left:before{border-left:4px solid #a93671;width:116px}#gamepad-dpad.pressed-right:before{border-right:4px solid #a93671;width:116px}#gamepad-dpad.pressed-up{border-top:4px solid #a93671}#gamepad-dpad.pressed-down{border-bottom:4px solid #a93671;height:116px}#gamepad-action1{bottom:30px;right:80px}#gamepad-action2{bottom:90px;right:30px}#gamepad-action1,#gamepad-action2{border:4px solid #a93671;border-radius:50px;height:60px;position:absolute;width:60px}#gamepad-action1.pressed,#gamepad-action2.pressed{background:#a93671}.play-button{border:2px solid;border-radius:20px;height:22px;left:calc(50vmin - 11px);top:calc(50vmin - 11px);transform:scale(4);width:22px}.play-button,.play-button:before{box-sizing:border-box;display:block;position:absolute}.play-button:before{border-bottom:5px solid transparent;border-left:6px solid;border-top:5px solid transparent;content:"";height:10px;left:7px;top:4px;width:0}.infobox{background:rgba(0,0,0,.8);color:#fff;cursor:pointer;height:100%;padding:20px;position:absolute;width:100vmin}body{overflow:hidden}</style>
  </head>
  <body>
    <div class="container">
      <div id="content">
        <div class="infobox">
          <h2 id="title"></h2>
          <h4 id="author"></h4>
          <span class="play-button"></span>
        </div>
        <div id="screenshot"></div>
      </div>
    </div>
    <div class="gamepad">
      <div id="gamepad-dpad"></div>
      <div id="gamepad-action1"></div>
      <div id="gamepad-action2"></div>
    </div>
    <script
      id="wasm4-cart-json"
      type="application/json"
    >{"WASM4_CART":"0ax}=0rr910Cq%K1+h2KE$4Da34ECOE$8@$E$4Da1B>]JE/J<UE$8}Fu&>?c0ak>TE/U4b00dNS0E>c1u&>.60EOnP0E!zTETRrDu&+YSE{-LfE0*r?E0*qxE{-lRu&>?c0!kYc1aLYC00n}%4fHfVB{q!{zeTDu0S-r517=v[1y=gYBn#pywO#U@vR/+2q/#KH0rV[JB{8R}zE&!H17=v[1..Z^zE&!I17=v[1:jY@zE&!I17=v[1AeD(yYBIswO#U]A+e:500imlzGVe8z/fa^0T01KB{Jh3CYV@cw&G+(17=v[33ph@v}wUZw&G+[17=v[1.qs*yJoyU17=v[1.qs*yJ/:Z0#8yM2m7Os1QLIz3>iTE1p2zC01PnD1aHtqPFWab0yrwo3X5gy01f2A0Tr^^wmoN>02C/WByxii02t]{850bMkl85}03znb01e]faoh=L03zpI1ooLA3J{CL0sJPwblp9]gIOcnlfHatdfxL{0yt{9yafk+ljFW6hV<480yt{9y9J:B>RD%50@%LDlfHatdfxMp2z!6)0@%LDlfHatblp9]gIOuv03.Ig>RD%50@$U1Hj}L*03.Ig>RD%50@@&tr@:DBbloX703.E?0v4Og7?$q@blp7oy9iHn0@%LDk[E=N0xg8X5e3h*k[E=W0@$T*D)nUT2X>^<0dxCz0ym0adfxM$blg1DyA@)804m)GbMOz-kl8]dbloX703.E?0v4Og5nAD<blp7oy9iHn0@$T/blp7oyafk+lihGC6g8W@blg1vyA@)804m)GbMOz-&Sf3703.I50STCBbMPa&lc64vbMG4&k)RiF067bYblp7wy9iKq0@%LDk]stV0YZt.blp7My9iQs0@%LDk}3E<1uuL:blp7:y9iWu0@%LDk@-Q41##+=blp9C0brRYirGma0ynbGd*2+@0ynXWd*2^Ablp7oyaxw^wfRavfLS9u03.IgZYna10%1#s0ymoid*2=ZAu+GI2X><(03.Ig7?$M60h7Lqk}3E#0@#>Kblp7wyaxw^blp7Myaxw^PD:F6fLS9u0aZ6]071WayA@)804m)GbMOz-S@-nC03.I50STCBbMPa&k[E=R01Za{0ysjLya6b-ldtl32sn4f<{aiv!#Yfy/-7vx5fh$@l9JgXk(-!A03.Ig:tmN00000000000irGma0yt6*yd544000000021Y03.Ig/Fvng00000008HMirGma0ytT1yd544000000021Y03.IgH=5{k06g8Wblp9]gIPm}TK:ltV*LTvhV<480yl<6k)f7E03.IgV[#I-1u3qYblp7oyc.?T0SSo!13!7ik)RiN0STCCl9@E-c&%xA1v9v%3NkWr[h1/70ym0ac&%xm5nV8H00000003fql&Wh!00014ZZ}Li0ym0ablp7oya6b-k(>ZU0SSSe3KXfVk[E/S03.E(0STFD3Y$+@ble}?huA>603?N&06@2FbMG4&l9JgXblp9mg?[Au06{T2huA>60ytu]yaxw^l&Wh!0000kkW%}Dblp9.gIOAx07l!!00000003Kkk(.n}kQcp}/Fvm!0ytu]yaxw^meT4O^OjgEkCg1s01g1Llc7&%blp9KgIOAx03.Ig/Fvm)0%1#O0@%LDk)RiI0ys^.yaxw^l&Wh!0000Ak+Qgu03.Ig5nBPk00000FmlkN0@%LDk]stY0ysHTya6b-k(+TK001kAl6BfveDt=<k(:Lo0STCCk]:R:0ys{^ya6b-eDt=p0Dyy9oeV?Kblp7Eya6b-blp7Iya6b-AS*>p0yqJ0yaPz=k(:vTk(.n}E<j$W/Fvm)0@$Z?000000001f1WJa@1vagjl5mykk(<1D03.Ig&4]ao00000001ofirGmETB+%uk)xRgblpa9g?[Au01Ywyblp8^hejYy06{SP1vagjleTLlblp9*gIOAx07l!!00000[irQb0@%LDlc}A5blp9SgIOAx03.Ig&4]9#0%1#O0@%LDleTLld*2=t0000000000wDUmy0ytT1yd544000000021Y03.IgH=5{k0Y*qY3K4:Ql5mykeDt=p0.9qTblp9*gIOcnleTLld*2=tgCZ*ygC^GAPG98Oblp9SgIOcnlc}A5d*2+@0ytT1yaxw^P/AhPblp9SgIOAx07l!!00000003NkkQcp}=[/A80000000000irGma0yqJ0yc.?X000xm3QS[O5ekmjblpa1gIPhQk[E<Ed*2+@0ys^.yaxw^l&Wh!0000Ak+R^U1vagjlguWBk(:gZy?+f}lc7&%d*2=t00000003Z#PG98Oblpa1gIPhQk[E<Ek)Ri[0000000000irGl?3QS[O5ekmjblpa1gIPhRk[E<Ed*2+@0ys^.yaxw^l&Wh!0000Ak+R^U1vagjlguWBk(<m.y?+f}lc7&%d*2=t00000003Z#PG98Oblpa1gIPhRk[E<Ek)Ri[0000000000irGl?3NkWr:tmMY0@%LDk)RiQ0%24)0Wv.i=[/z!0%1=m0ymoid*2^B}#Pd>k[<>mblp7Myc.?T0SSo!13!7ik{f[<0STCCl9@E-c&%xA1v9v%3NkWr[h1/70ym&yc&%xm5nV8i0@%LDk)RiQ0%24)0Wv.i[h1/70ym&yc&%xm5nV8E2X><(0gCbkk[E=Y0%22.00000001ofP.[<S3pb1g1%TdmazJb4k{f[<0SUH!ybMa[3&*Uyblp7Myc.?T0SSo!13!7ik{f[<0STCCl9@E-c&%xA1v9v%3NkWr:tmMY0@%LDlc}A5d*2=t00000001ofl&Wh!0000QkQcp}[h1/70ym&yc&%xm5nV8i0@%LDlguWBblp7Mya6b-k[E<Ek)RiQ0@$Z?0000003<\u002F$00000001of5etskl8MI83pa?Y9UoeOU}[VVk)oLf5eVR)ld^#dl&Wh!00000067bYblp9*gIPqT000000000V0@%LDl5mykk(-}C01g1Lk{f[!0ym&yc&%xm0CTH]01n&n3QHBwk)GWSk(}Pmblp9KgIOAx0q({z0yqM1y7IsIcQv!B7:x2Dc#g7dblfa[03?NMA@WA+bloX703.E?0v4Og7?$q@blp7ky9S<90W4F30STCDk)g{B0x6#Vblp7sy9iNo0STCCk[E=N12ZhXblp7kya6b-blp7kyc.#qc&%w[0ymcec&%w[0ymoic&%wW2Qosn7&7w%blfa[03?NMpxhQtbloX703.E?0v4Og5nAD<blp7ky9S<90W4F30STCDk)g{B0x6#Vblp7kya6b-blp7kyc.#qc&%wW2{PBo5nJJ>blfa[03?NMJ@Yk903.I50STCBbMPa&k[E=R03.Ig1zP4VhuA>60ym0ak(-}C00ky/kQcp}1zPs^06{]=1vagjk)RiS002p=y9JZA5nJJ>blfa[03?NQ3NkWr2X>N+k)RiS002p=yb#s{blp7ky9J:B1zPs^06{%fhuA<\u002101ff203.Ff5nJJ>blfa[03?NQ3XXV.ble}?huA>603?N&06}-xbMG4&k)g{B05:(Ublp7oy9iKn0STCCk[4GM0yl<6c&%wW8A4S%blp7Eyc.?X001kAk[E=%05:(Ublp7Ay9J:B5nAP{05:(U0ZD&Mblp7Aya6b-k)*x<kNWY4blp7oya6b-blp7Aya6b-yc-$6001kAk[[5U0ymAmc&%xm0CTH]01n&n3J-M}kQcp}1zPs^06{]=1vagjk]stY0yl<6c&%xf001kAk)RiN0STCCk[4GR0STCCk[E=V0SW1Jblp7EyaPz=k})4m001kAk[E=Q0ymoic&%xm0CTH]01n]pblp7Ey9J:B1zPs^06{%hiSGd80yl<6blp7kya6b-k)?G/0STCCk)RiN0STCCk[4GR0STCCk[E=V0SW1Jblp7EyaPz=k})4m001kAk[E=Q0ymoic&%xm0CTH]01n&n3NkWr2X>:?06{Q1blp7wya6b-blg1LyA@)804m)GbMOz-QxgAu0ysjLyc.$X0STCCla/3?k[(iU03.IgZ+/^(7b=i]blp9Gg?]q{huA>60ys^-yc-*$0STCClcIf2k]}]=03.Ig=[]G6PAc}L03.IgLqN8v0xHhXblp8{hekzUiSGd80yq#dyc-y(001kAl6:xyk{eh*03.IgMO&IzZYly}03.IgM]eRAFb}Xh03.Ig!hg]a0x6#Vblp9.g?]qRhuA>60ytG$yc.[V0STCCleTOmk)f7E03.Ig<tpQq2Sq.:blp9]g?]qRhuA>60yu6eyc.>U0STCClguZCk(@}C03.Ig]FyqG12ZhXblpa9g?]qRhuA>60yuSuyc.$X0STCCl4y?ck)PvI03.IgGF^Hg3]Od!3NU]%03zq20STtyk)g{B0Yy8WaojXky9iQp0STtyk[4GJ1u3qY3LJH.03zq50@%Czk)RiF0YZt.3KX(}070nl3KoP$pF%RxaojZ9gyBKWk$%=<pGx[Ze=XhxgyB<)A+frkaw%t7zY<7iB97&hBs)NE0%AHIzdJ+t0V}yBvR/+20sidJx()Z6BZ+yPy?W=#0%JvOx(mF+1:jY@zE&$Oz*2M91{w%Tv@}}UBz(5d2NCJ-CYV@cw&H86BAg/1wMr?:i0]?1x(!6g3K76PB8b$d5o?M7zc}c>zeTDuuVP}cwEPh{vrlo)zdNN5A^q28A=ldi6/[x%BAhIlBuhDUvSMT1v@bZqi^qeIiY.t7A=>(liYZ5CB97&2y?kT*C[p&Oi=/y-BZ]IOi-ycvx(mMAi=G1KzGGDg5G0L&B98CBv@%:)q/)4]zF80>y?mG%Bz8o&A:-&@6ae+*zE^9{vqYZ?6B5F[wNxd?6+UK#v@#c%xkzd2uT[1<y?WA>76O=3vrcDa26B(}vru5$1AXj1BqUm7A:-D?8vQa]B-8qdwnbW<BAnxgx(n31Bz>JcBAh8kxb?I8wPRp6vrloxuVQr$Bzkla9ss?*B98tvwJz>a9TT}?B98tvwJz>b14rtd0SSsiuOzG.y*O>j1pUDxuOJ2)y*O[d17CQ)5D=&Rg8Zh]17CQ[0rWdBgAcC%17CQ]0rWdBgY)??uO}@*y*P4876sKrB8RcYvShwRzdNM>vpS[?wPI[)","WASM4_CART_SIZE":4083}</script>
    <script id="wasm4-js">(()=>{"use strict";const t=160,e=160,n=[14743759,8831084,3172432,464929],i=128,a=Uint8Array.of(255,255,255,255,255,255,255,255,199,199,199,207,207,255,207,255,147,147,147,255,255,255,255,255,147,1,147,147,147,1,147,255,239,131,47,131,233,3,239,255,157,91,55,239,217,181,115,255,143,39,39,143,37,51,129,255,207,207,207,255,255,255,255,255,243,231,207,207,207,231,243,255,159,207,231,231,231,207,159,255,255,147,199,1,199,147,255,255,255,231,231,129,231,231,255,255,255,255,255,255,255,207,207,159,255,255,255,129,255,255,255,255,255,255,255,255,255,207,207,255,253,251,247,239,223,191,127,255,199,179,57,57,57,155,199,255,231,199,231,231,231,231,129,255,131,57,241,195,135,31,1,255,129,243,231,195,249,57,131,255,227,195,147,51,1,243,243,255,3,63,3,249,249,57,131,255,195,159,63,3,57,57,131,255,1,57,243,231,207,207,207,255,135,59,27,135,97,121,131,255,131,57,57,129,249,243,135,255,255,207,207,255,207,207,255,255,255,207,207,255,207,207,159,255,243,231,207,159,207,231,243,255,255,255,1,255,1,255,255,255,159,207,231,243,231,207,159,255,131,1,57,243,199,255,199,255,131,125,69,85,65,127,131,255,199,147,57,57,1,57,57,255,3,57,57,3,57,57,3,255,195,153,63,63,63,153,195,255,7,51,57,57,57,51,7,255,1,63,63,3,63,63,1,255,1,63,63,3,63,63,63,255,193,159,63,49,57,153,193,255,57,57,57,1,57,57,57,255,129,231,231,231,231,231,129,255,249,249,249,249,249,57,131,255,57,51,39,15,7,35,49,255,159,159,159,159,159,159,129,255,57,17,1,1,41,57,57,255,57,25,9,1,33,49,57,255,131,57,57,57,57,57,131,255,3,57,57,57,3,63,63,255,131,57,57,57,33,51,133,255,3,57,57,49,7,35,49,255,135,51,63,131,249,57,131,255,129,231,231,231,231,231,231,255,57,57,57,57,57,57,131,255,57,57,57,17,131,199,239,255,57,57,41,1,1,17,57,255,57,17,131,199,131,17,57,255,153,153,153,195,231,231,231,255,1,241,227,199,143,31,1,255,195,207,207,207,207,207,195,255,127,191,223,239,247,251,253,255,135,231,231,231,231,231,135,255,199,147,255,255,255,255,255,255,255,255,255,255,255,255,255,1,239,247,255,255,255,255,255,255,255,255,131,249,129,57,129,255,63,63,3,57,57,57,131,255,255,255,129,63,63,63,129,255,249,249,129,57,57,57,129,255,255,255,131,57,1,63,131,255,241,231,129,231,231,231,231,255,255,255,129,57,57,129,249,131,63,63,3,57,57,57,57,255,231,255,199,231,231,231,129,255,243,255,227,243,243,243,243,135,63,63,49,3,7,35,49,255,199,231,231,231,231,231,129,255,255,255,3,73,73,73,73,255,255,255,3,57,57,57,57,255,255,255,131,57,57,57,131,255,255,255,3,57,57,3,63,63,255,255,129,57,57,129,249,249,255,255,145,143,159,159,159,255,255,255,131,63,131,249,3,255,231,231,129,231,231,231,231,255,255,255,57,57,57,57,129,255,255,255,153,153,153,195,231,255,255,255,73,73,73,73,129,255,255,255,57,1,199,1,57,255,255,255,57,57,57,129,249,131,255,255,1,227,199,143,1,255,243,231,231,207,231,231,243,255,231,231,231,231,231,231,231,255,159,207,207,231,207,207,159,255,255,255,143,69,227,255,255,255,255,255,255,255,255,147,147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,231,255,231,231,199,199,199,255,239,131,41,47,41,131,239,255,195,153,159,3,159,159,1,255,255,165,219,219,219,165,255,255,153,153,195,129,231,129,231,255,231,231,231,255,231,231,231,255,195,153,135,219,225,153,195,255,147,255,255,255,255,255,255,255,195,189,102,94,94,102,189,195,135,195,147,195,255,255,255,255,255,201,147,39,147,201,255,255,255,255,129,249,249,255,255,255,255,255,255,255,255,255,255,255,195,189,70,90,70,90,189,195,131,255,255,255,255,255,255,255,239,215,239,255,255,255,255,255,231,231,129,231,231,255,129,255,199,243,231,195,255,255,255,255,195,231,243,199,255,255,255,255,247,239,255,255,255,255,255,255,255,255,51,51,51,51,9,63,193,149,181,149,193,245,245,255,255,255,255,207,207,255,255,255,255,255,255,255,255,255,247,207,231,199,231,195,255,255,255,255,199,147,147,199,255,255,255,255,255,39,147,201,147,39,255,255,189,59,183,173,217,177,125,255,189,59,183,169,221,187,113,255,29,187,215,45,217,177,125,255,199,255,199,159,57,1,131,255,223,239,199,147,57,1,57,255,247,239,199,147,57,1,57,255,199,147,199,147,57,1,57,255,203,167,199,147,57,1,57,255,147,255,199,147,57,1,57,255,239,215,199,147,57,1,57,255,193,135,39,33,7,39,33,255,195,153,63,63,153,195,247,207,223,239,1,63,3,63,1,255,247,239,1,63,3,63,1,255,199,147,1,63,3,63,1,255,147,255,1,63,3,63,1,255,239,247,129,231,231,231,129,255,247,239,129,231,231,231,129,255,231,195,129,231,231,231,129,255,153,255,129,231,231,231,129,255,135,147,153,9,153,147,135,255,203,167,25,9,1,33,49,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,187,215,239,215,187,255,255,131,57,49,41,25,57,131,255,223,239,57,57,57,57,131,255,247,239,57,57,57,57,131,255,199,147,255,57,57,57,131,255,147,255,57,57,57,57,131,255,247,239,153,153,195,231,231,255,63,3,57,57,57,3,63,255,195,153,153,147,153,137,147,255,223,239,131,249,129,57,129,255,247,239,131,249,129,57,129,255,199,147,131,249,129,57,129,255,203,167,131,249,129,57,129,255,147,255,131,249,129,57,129,255,239,215,131,249,129,57,129,255,255,255,131,233,129,47,131,255,255,255,129,63,63,129,247,207,223,239,131,57,1,63,131,255,247,239,131,57,1,63,131,255,199,147,131,57,1,63,131,255,147,255,131,57,1,63,131,255,223,239,255,199,231,231,129,255,247,239,255,199,231,231,129,255,199,147,255,199,231,231,129,255,147,255,199,231,231,231,129,255,155,135,103,131,57,57,131,255,203,167,3,57,57,57,57,255,223,239,131,57,57,57,131,255,247,239,131,57,57,57,131,255,199,147,131,57,57,57,131,255,203,167,131,57,57,57,131,255,147,255,131,57,57,57,131,255,255,231,255,129,255,231,255,255,255,255,131,49,41,25,131,255,223,239,57,57,57,57,129,255,247,239,57,57,57,57,129,255,199,147,255,57,57,57,129,255,147,255,57,57,57,57,129,255,247,239,57,57,57,129,249,131,63,63,3,57,57,3,63,63,147,255,57,57,57,129,249,131),r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ.-:+=^!/*?&<>()[]{}@%$#".split(""),s=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];function o(t,e){let n=0,i=0,a=t.length,r=e.length,o=0;if(t.length%5==0)for(;i<a;){let a=t.charCodeAt(i++)-32;if(a<0||a>=s.length)return n;if(o=85*o+s[a],i%5==0){let t=16777216;for(;t>=1;){if(n>=r)return n;e[n++]=o/t%256,t/=256}o=0}}return n}const c=2048;class d{constructor(){const t=new(window.AudioContext||window.webkitAudioContext);function e(e){const n=new Float32Array(c);for(let t=1;t<c;t++)n[t]=4/(t*Math.PI)*Math.sin(Math.PI*t*e);return t.createPeriodicWave(n,new Float32Array(c))}this.ctx=t,this.nodes=new Array(4);const n=e(.25);this.pulseDutyCycles=[e(.125),n,e(.5),n];const i=t.createBuffer(1,32768,t.sampleRate),a=i.getChannelData(0);let r=1;for(let t=0;t<32768;++t){const e=1&r;r>>=1;const n=e^1&r;r|=n<<14,a[t]=n}this.noiseBuffer=i}tone(t,e,n,i){const a=65535&t,r=t>>16&65535,s=(255&e)/60,o=(e>>8&255)/60,c=(e>>16&255)/60,d=(e>>24&255)/60,l=3&i,f=i>>2&3,h=this.ctx,u=h.currentTime+d,m=u+c,w=m+s,p=w+o;let b=1,y=n/100;0!=l&&1!=l||(b*=.5,y*=.5);const g=h.createGain(),x=g.gain;let U;if(x.setValueAtTime(0,0),x.linearRampToValueAtTime(b,u),x.linearRampToValueAtTime(y,m),x.linearRampToValueAtTime(y,w),x.linearRampToValueAtTime(0,p),3==l){U=h.createBufferSource(),U.buffer=this.noiseBuffer,U.loop=!0;const t=U.playbackRate;t.setValueAtTime(a*a/1e6,0),r&&t.linearRampToValueAtTime(r*r/1e6,p)}else{if(U=h.createOscillator(),2==l)U.type="triangle";else{const t=this.pulseDutyCycles[f];U.setPeriodicWave(t)}const t=U.frequency;t.setValueAtTime(a,0),r&&t.linearRampToValueAtTime(r,p)}const v=this.nodes[l];null!=v&&v.stop(0),this.nodes[l]=U,U.start(0),U.stop(p),U.connect(g),g.connect(h.destination)}}function l(t){const e=15&t[0];return e?e-1&3:0}class f{constructor(t){this.bytes=new Uint8Array(t,160,6400),this.drawColors=new Uint16Array(t,20,1)}clear(){this.bytes.fill(0)}drawPoint(e,n,i){const a=t*i+n>>>2,r=(3&n)<<1,s=3<<r;this.bytes[a]=e<<r|this.bytes[a]&~s}drawPointUnclipped(n,i,a){i>=0&&i<t&&a>=0&&a<e&&this.drawPoint(n,i,a)}drawHLineInternal(e,n,i,a){const r=a-(3&a),s=Math.min(n+3&-4,r);if(r-s>3){for(let t=n;t<s;t++)this.drawPoint(e,t,i);const a=t*i+s>>>2,o=t*i+r>>>2,c=85*e;this.bytes.fill(c,a,o),n=r}for(let t=n;t<a;t++)this.drawPoint(e,t,i)}drawHLine(n,i,a){if(n+a<=0||i<0||i>=e)return;const r=l(this.drawColors);if(0===r)return;const s=Math.max(0,n),o=Math.min(t,n+a);this.drawHLineInternal(r,s,i,o)}drawVLine(n,i,a){if(i+a<=0||n<0||n>=t)return;const r=l(this.drawColors);if(0===r)return;const s=Math.max(0,i),o=Math.min(e,i+a);for(let t=s;t<o;t++)this.drawPoint(r,n,t)}drawRect(n,i,a,r){const s=Math.max(0,n),o=Math.max(0,i),c=n+a,d=i+r,l=Math.min(c,t),f=Math.min(d,e),h=this.drawColors[0],u=15&h,m=h>>>4&15,w=+(0!==m);if(0!==u){const t=u-1&3;for(let e=o+w;e<f-w;++e)this.drawHLineInternal(t,s+w,e,l-w)}if(0!==m){const e=m-1&3;if(n>=0&&n<t)for(let t=o;t<f-1;++t)this.drawPoint(e,n,t);if(l>0&&c<161)for(let t=o;t<f-1;++t)this.drawPoint(e,l-1,t);this.drawHLineInternal(e,s,o,l),this.drawHLineInternal(e,s,f-1,l)}}drawOval(e,n,i,a){const r=this.drawColors[0],s=15&r,o=r>>>4&15;if(15===o)return;const c=o-1&3,d=s-1&3,l=i>>>1,f=a>>>1;if(l<=0)return;if(f<=0)return;const h=e+l,u=n+f,m=l*l*2,w=f*f*2;{let e=l,n=0,i=(1-2*l)*f*f,a=l*l,r=w*l,o=0,p=0;for(;r>=o;){this.drawPointUnclipped(c,h+e,u+n),this.drawPointUnclipped(c,h+e,u-n),this.drawPointUnclipped(c,h-e,u+n),this.drawPointUnclipped(c,h-e,u-n);const l=Math.max(h-e+1,0),f=Math.min(h+e,t);0!==s&&f-l>0&&(this.drawHLineInternal(d,l,u+n,f),this.drawHLineInternal(d,l,u-n,f)),n++,o+=m,p+=a,a+=m,2*p+i>0&&(e--,r-=w,p+=i,i+=w)}}{let e=0,n=f,i=f*f,a=(1-2*f)*l*l,r=0,o=m*f,p=0,b=0;for(;o>=r;)if(this.drawPointUnclipped(c,h+e,u+n),this.drawPointUnclipped(c,h+e,u-n),this.drawPointUnclipped(c,h-e,u+n),this.drawPointUnclipped(c,h-e,u-n),e++,r+=w,p+=i,i+=w,b++,2*p+a>0){if(0!==s){const i=e-b-1,a=Math.max(h-i,0),r=Math.min(h+i+1,t);r-a>0&&(this.drawHLineInternal(d,a,u+n,r),this.drawHLineInternal(d,a,u-n,r))}n--,o-=m,p+=a,a+=m,b=0}}}drawLine(t,e,n,i){const a=15&this.drawColors[0];if(0===a)return;const r=a-1&3;if(e>i){let a=t;t=n,n=a,a=e,e=i,i=a}const s=Math.abs(n-t),o=t<n?1:-1,c=i-e;let d,l=(s>c?s:-c)/2;for(;this.drawPointUnclipped(r,t,e),t!==n||e!==i;)d=l,d>-s&&(l-=c,t+=o),d<c&&(l+=s,e++)}drawText(t,e,n){let i=e;for(let r=0,s=t.length;r<s;++r){const s=t[r];switch(s){case 0:return;case 10:n+=8,i=e;break;default:this.blit(a,i,n,8,8,0,s-32<<3,8),i+=8}}}blit(n,i,a,r,s,o,c,d,l=!1,f=!1,h=!1,u=!1){const m=Math.max(0,i)-i,w=Math.max(0,a)-a,p=Math.min(r,t-i),b=Math.min(s,e-a),y=this.drawColors[0];u&&(f=!f);for(let t=w;t<b;++t)for(let e=m;e<p;++e){let r,s,m;u?(r=t,s=e):(r=e,s=t),f&&(r=p-r-1),h&&(s=b-s-1);const w=o+r,g=c+s;m=l?n[g*d+w>>>2]>>>6-((3&w)<<1)&3:n[g*d+w>>>3]>>>7-(7&w)&1;const x=y>>>(m<<2)&15;0!==x&&this.drawPoint(x-1&3,i+e,a+t)}}}const h=6409,u=3553;class m{constructor(n){this.gl=n,this.colorBuffer=new Uint32Array(6400),this.paletteBuffer=new Float32Array(12),this.lastPalette=Array(4);const i=new Uint32Array(256);for(let t=0;t<256;++t){const e=t>>6&3,n=t>>4&3,a=t>>2&3,r=3&t;i[t]=e<<30|n<<22|a<<14|r<<6}function a(t,e){const i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}this.table=i;const r=a(35633,"\n            attribute vec2 pos;\n            varying vec2 framebufferCoord;\n\n            void main () {\n                framebufferCoord = pos*vec2(0.5, -0.5) + 0.5;\n                gl_Position = vec4(pos, 0, 1);\n            }\n        "),s=a(35632,`\n            precision mediump float;\n            uniform vec3 palette[4];\n            uniform sampler2D framebuffer;\n            varying vec2 framebufferCoord;\n\n            vec3 lookup(float index) {\n                vec3 p = palette[0];\n                ${Array.from({length:3},((t,e)=>`p = mix(p, palette[${e+1}],  step(${((e+1)/4).toFixed(2)}, index));`)).join("\n")}\n                return p;\n            }\n\n            void main () {\n                gl_FragColor = vec4(lookup(texture2D(framebuffer, framebufferCoord).r), 1.);\n            }\n        `),o=n.createProgram();n.attachShader(o,r),n.attachShader(o,s),n.linkProgram(o),n.useProgram(o),this.paletteLocation=n.getUniformLocation(o,"palette"),n.uniform1i(n.getUniformLocation(o,"framebuffer"),0),n.detachShader(o,r),n.deleteShader(r),n.detachShader(o,s),n.deleteShader(s),function(t){const e=n.createTexture();n.activeTexture(33984),n.bindTexture(u,e),n.texParameteri(u,10242,33071),n.texParameteri(u,10243,33071),n.texParameteri(u,10240,9728),n.texParameteri(u,10241,9728)}(),n.texImage2D(u,0,h,t,e,0,h,5121,null);const c=n.getAttribLocation(o,"pos"),d=n.createBuffer(),l=new Float32Array([-1,-1,-1,1,1,1,1,1,1,-1,-1,-1]);n.bindBuffer(34962,d),n.bufferData(34962,l,35044),n.enableVertexAttribArray(c),n.vertexAttribPointer(c,2,5126,!1,0,0)}composite(n,i){const a=this.gl,r=i.bytes,s=this.colorBuffer,o=this.table,c=this.lastPalette,d=this.paletteBuffer;let l=!1;for(let t=0,e=0;t<4;++t){const i=n[t];l=l||c[t]!==i,d[e++]=(i>>16&255)/255,d[e++]=(i>>8&255)/255,d[e++]=(255&i)/255,c[t]=i}l&&a.uniform3fv(this.paletteLocation,this.paletteBuffer);for(let t=0;t<6400;++t)s[t]=o[r[t]];a.texImage2D(u,0,h,t,e,0,h,5121,new Uint8Array(s.buffer)),a.drawArrays(4,0,6)}}const w="4444"==location.port?new WebSocket("ws://"+location.host):null;class p{constructor(){const n=document.createElement("canvas");n.width=t,n.height=e,this.canvas=n;const i=n.getContext("webgl",{alpha:!1,depth:!1,antialias:!1});this.compositor=new m(i),this.apu=new d,this.memory=new WebAssembly.Memory({initial:1,maximum:1}),this.data=new DataView(this.memory.buffer),this.framebuffer=new f(this.memory.buffer),this.reset(),this.paused=!1}setMouse(t,e,n){this.data.setInt16(26,t,!0),this.data.setInt16(28,e,!0),this.data.setUint8(30,n)}setGamepad(t,e){this.data.setUint8(22+t,e)}getGamepad(t){return this.data.getUint8(22+t)}maskGamepad(t,e,n){const i=22+t;let a=this.data.getUint8(i);n?a|=e:a&=~e,this.data.setUint8(i,a)}unlockAudio(){const t=this.apu.ctx;"suspended"==t.state&&t.resume()}reset(t){const e=new Uint32Array(this.memory.buffer);t&&e.fill(0),e.set(n,1),this.data.setUint16(20,4611,!0),this.data.setInt16(26,32767,!0),this.data.setInt16(28,32767,!0)}async load(t){const e={memory:this.memory,rect:this.framebuffer.drawRect.bind(this.framebuffer),oval:this.framebuffer.drawOval.bind(this.framebuffer),line:this.framebuffer.drawLine.bind(this.framebuffer),hline:this.framebuffer.drawHLine.bind(this.framebuffer),vline:this.framebuffer.drawVLine.bind(this.framebuffer),text:this.text.bind(this),textUtf8:this.textUtf8.bind(this),textUtf16:this.textUtf16.bind(this),blit:this.blit.bind(this),blitSub:this.blitSub.bind(this),tone:this.apu.tone.bind(this.apu),diskr:this.diskr.bind(this),diskw:this.diskw.bind(this),trace:this.trace.bind(this),traceUtf8:this.traceUtf8.bind(this),traceUtf16:this.traceUtf16.bind(this),tracef:this.tracef.bind(this),seed:Date.now,abort:function(){}},n=await WebAssembly.instantiate(t,{env:e});this.wasm=n.instance,null!=this.wasm.exports._start&&this.wasm.exports._start(),null!=this.wasm.exports._initialize&&this.wasm.exports._initialize()}text(t,e,n){const i=new Uint8Array(this.memory.buffer,t);this.framebuffer.drawText(i,e,n)}textUtf8(t,e,n,i){const a=new Uint8Array(this.memory.buffer,t,e);this.framebuffer.drawText(a,n,i)}textUtf16(t,e,n,i){const a=new Uint16Array(this.memory.buffer,t,e>>1);this.framebuffer.drawText(a,n,i)}blit(t,e,n,i,a,r){this.blitSub(t,e,n,i,a,0,0,i,r)}blitSub(t,e,n,i,a,r,s,o,c){const d=new Uint8Array(this.memory.buffer,t),l=1&c,f=2&c,h=4&c,u=8&c;this.framebuffer.blit(d,e,n,i,a,r,s,o,l,f,h,u)}diskr(t,e){let n;try{n=localStorage.getItem("disk")}catch(t){}return null==n?0:o(n,new Uint8Array(this.memory.buffer,t,Math.min(e,1024)))}diskw(t,e){const n=Math.min(e,1024),i=function(t){const e=t.length,n=e%4,i=n?e+4-n:e;let a="",s=0,o=0;for(;s<i;){const n=s<e?t[s]:0;if(++s,o=256*o+n,s%4==0){let t=52200625;for(;t>=1;){const e=Math.floor(o/t)%85;a+=r[e],t/=85}o=0}}return a}(new Uint8Array(this.memory.buffer,t,n));try{localStorage.setItem("disk",i)}catch(t){return 0}return n}getCString(t){let e="";for(;;){const n=this.data.getUint8(t++);if(0==n)break;e+=String.fromCharCode(n)}return e}print(t){console.log(t),null!=w&&1==w.readyState&&w.send(t)}trace(t){this.print(this.getCString(t))}traceUtf8(t,e){const n=new Uint8Array(this.memory.buffer,t,e),i=(new TextDecoder).decode(n);this.print(i)}traceUtf16(t,e){const n=new Uint8Array(this.memory.buffer,t,e),i=new TextDecoder("utf-16").decode(n);this.print(i)}tracef(t,e){var n="";let i;for(;i=this.data.getUint8(t++);)if(37==i)switch(i=this.data.getUint8(t++)){case 37:n+="%";break;case 99:n+=String.fromCharCode(this.data.getInt32(e,!0)),e+=4;break;case 100:case 120:n+=this.data.getInt32(e,!0).toString(100==i?10:16),e+=4;break;case 115:let t=this.data.getUint32(e,!0);n+=this.getCString(t),e+=4;break;case 102:n+=this.data.getFloat64(e,!0),e+=8}else n+=String.fromCharCode(i);this.print(n)}start(){null!=this.wasm.exports.start&&this.wasm.exports.start()}update(){this.paused||(this.framebuffer.clear(),null!=this.wasm.exports.update&&this.wasm.exports.update(),this.composite())}composite(){const t=new Uint32Array(this.memory.buffer,4,16);this.compositor.composite(t,this.framebuffer)}}const b=new URL(document.location).searchParams,y=b.get("screenshot");if(null!=y){const t=document.createElement("img");t.src=y,document.getElementById("screenshot").appendChild(t)}const g=b.get("title");null!=g&&(document.getElementById("title").textContent=g);const x=b.get("author");function U(t,e,n){n?t.classList.add(e):t.classList.remove(e)}async function v(){const t=document.getElementById("wasm4-cart-json");if(t){const{WASM4_CART:e,WASM4_CART_SIZE:n}=JSON.parse(t.textContent),i=new Uint8Array(n);return o(e,i),i}{const t=b.has("url")?b.get("url"):"cart.wasm",e=await fetch(t);return await e.arrayBuffer()}}null!=x&&(document.getElementById("author").textContent="by "+x),async function(){const n=new p,a=n.canvas;document.getElementById("content").appendChild(a);const r=await v();await n.load(r),null!=y&&(await new Promise((t=>{window.onpointerdown=function(){window.onpointerdown=null,n.unlockAudio(),t()}})),window.onblur=function(){document.body.classList.remove("focus")},window.onfocus=function(){document.body.classList.add("focus")}),document.body.classList.add("focus"),n.start(),null!=w&&w.addEventListener("message",(async t=>{switch(t.data){case"reload":case"hotswap":const e=await v();"reload"==t.data&&n.reset(!0),await n.load(e),n.start()}}));let s=null,o=null;function c(){null==document.fullscreenElement&&document.body.requestFullscreen({navigationUI:"hide"})}const d=i=>{if(document.body.style.cursor="",i.isPrimary){const r=a.getBoundingClientRect(),s=Math.fround(t*(i.clientX-r.left)/r.width),o=Math.fround(e*(i.clientY-r.top)/r.height),c=7&i.buttons;n.setMouse(s,o,c)}};window.addEventListener("pointerdown",d),window.addEventListener("pointerup",d),window.addEventListener("pointermove",d),a.addEventListener("contextmenu",(t=>{t.preventDefault()}));const l={50:function(){o=new Uint32Array(n.memory.buffer.slice())},52:function(){null!=o&&new Uint32Array(n.memory.buffer).set(o)},82:async function(){n.reset(!0),await n.load(r),n.start()},120:function(){n.composite(),a.toBlob((t=>{const e=URL.createObjectURL(t),n=document.createElement("a");n.href=e,n.download="wasm4-screenshot.png",n.click(),URL.revokeObjectURL(e)}))},121:function(){if(null!=s)return;const t="video/webm",e=a.captureStream();s=new MediaRecorder(e,{mimeType:t,videoBitsPerSecond:25e6});const n=[];s.ondataavailable=t=>{n.push(t.data)},s.onstop=()=>{const e=new Blob(n,{type:t}),i=URL.createObjectURL(e),a=document.createElement("a");a.href=i,a.download="wasm4-animation.webm",a.click(),URL.revokeObjectURL(i)},s.start(),setTimeout((()=>{s.requestData(),s.stop(),s=null}),4e3)},122:c};let f=!0;const h=t=>{const e="keydown"==t.type;if(f||n.setGamepad(0,0),f=!0,n.unlockAudio(),document.body.style.cursor="none",e){const e=l[t.keyCode];if(e)return e(),void t.preventDefault()}let a=0;switch(t.keyCode){case 88:case 32:case 81:a=1;break;case 90:case 18:case 186:case 67:case 74:case 89:a=2;break;case 38:a=64;break;case 40:a=i;break;case 37:a=16;break;case 39:a=32}0!=a&&(t.preventDefault(),n.maskGamepad(0,a,e))};window.addEventListener("keydown",h),window.addEventListener("keyup",h);let u=-1;window.addEventListener("gamepadconnected",(t=>{for(const t of navigator.getGamepads())if(t){u=t.index;break}})),window.addEventListener("gamepaddisconnected",(t=>{if(t.gamepad.index===u){u=-1,n.setGamepad(0,0);for(const t of navigator.getGamepads())if(t){u=t.index;break}}}));const m=document.getElementById("gamepad-dpad"),b=document.getElementById("gamepad-action1"),g=document.getElementById("gamepad-action2"),x=new Map;function A(t){if("pointerup"==t.type&&("touch"==t.pointerType&&c(),n.unlockAudio()),"touch"!=t.pointerType)return;switch(t.preventDefault(),t.type){case"pointerdown":case"pointermove":x.set(t.pointerId,t);break;default:x.delete(t.pointerId)}let e=0;if(x.size){const t=100,n=10,a=50,r=.6,s=m.getBoundingClientRect(),o=s.x+s.width/2,c=s.y+s.height/2,d=b.getBoundingClientRect(),l=d.x+d.width/2,f=d.y+d.height/2,h=g.getBoundingClientRect(),u=h.x+h.width/2,w=h.y+h.height/2;let p,y,U,v,A;for(let s of x.values())p=s.clientX-o,y=s.clientY-c,U=Math.sqrt(p*p+y*y),U<t&&U>n&&(v=p/U,A=y/U,-v>r?e|=16:v>r&&(e|=32),-A>r?e|=64:A>r&&(e|=i)),p=s.clientX-l,y=s.clientY-f,p*p+y*y<a*a&&(e|=1),p=s.clientX-u,y=s.clientY-w,p*p+y*y<a*a&&(e|=2)}const a=3&e,r=3&n.getGamepad(0);a&&!r&&navigator.vibrate(1),U(b,"pressed",1&e),U(g,"pressed",2&e),U(m,"pressed-left",16&e),U(m,"pressed-right",32&e),U(m,"pressed-up",64&e),U(m,"pressed-down",e&i),n.setGamepad(0,e)}window.addEventListener("pointercancel",A),window.addEventListener("pointerdown",A),window.addEventListener("pointermove",A),window.addEventListener("pointerup",A);const L=1e3/60;let k=performance.now();!function t(){!function(){if(-1===u)return;const t=navigator.getGamepads()[u];if(!t)return;const e=t.buttons,a=t.axes,r=e.length>12,s=r&&e[12].pressed||a[1]<-.5,o=r&&e[13].pressed||a[1]>.5,c=r&&e[14].pressed||a[0]<-.5,d=r&&e[15].pressed||a[0]>.5,l=e[0].pressed||e[6].pressed,h=e[1].pressed||e[7].pressed;let m=0;m|=64&-s,m|=i&-o,m|=16&-c,m|=32&-d,m|=1&-l,m|=2&-h,0===m&&f||(f=!1,n.setGamepad(0,m))}(),requestAnimationFrame(t);const e=performance.now(),a=e-k;a>=L&&(k=e-a%L,n.update())}()}()})();</script>
  </body>
</html>
